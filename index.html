<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Control de Accesos - Academia de Danza</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <h1>Control de Accesos</h1>
    <div class="mode-switch">
      <button id="btnAlumno" class="mode-btn active" aria-pressed="true">Modo Alumno</button>
      <button id="btnAdmin" class="mode-btn" aria-pressed="false">Modo Administrador</button>
    </div>
  </header>

  <main>
    <!-- ========== MODO ALUMNO ========== -->
    <section id="alumnoSection" class="panel">
      <div class="card">
        <h2>Ingresar código</h2>
        <div id="pinDisplay" class="pin-display" aria-live="polite" aria-atomic="true">— — — —</div>
        <div class="keypad" role="group" aria-label="Teclado numérico">
          <button class="key">1</button><button class="key">2</button><button class="key">3</button>
          <button class="key">4</button><button class="key">5</button><button class="key">6</button>
          <button class="key">7</button><button class="key">8</button><button class="key">9</button>
          <button class="key action" data-action="borrar">Borrar</button>
          <button class="key">0</button>
          <button class="key action" data-action="entrar">Entrar</button>
        </div>
        <p class="hint">El código es de 4 dígitos.</p>
        <div id="alumnoFeedback" class="feedback" aria-live="assertive"></div>
      </div>

      <div id="alumnoPerfil" class="card hidden">
        <div class="perfil-header">
          <img id="perfilFoto" class="perfil-foto" src="assets/default-avatar.png" alt="Foto de perfil" />
          <div>
            <h3 id="perfilNombre">Nombre del alumno</h3>
            <p><strong>Paquete:</strong> <span id="perfilPaquete"></span> &middot; <strong>Clases restantes:</strong> <span id="perfilRestantes"></span></p>
            <p><strong>Vigencia:</strong> <span id="perfilFechas"></span></p>
            <p><strong>Último pago:</strong> <span id="perfilUltimoPago"></span></p>
          </div>
        </div>

        <div class="perfil-actions">
          <button id="btnMarcarAsistencia">Marcar asistencia</button>
          <button id="btnReagendar" class="secondary">Re-agendar (con pago)</button>
          <button id="btnCerrarSesion" class="danger">Cerrar sesión</button>
        </div>

        <div id="agendaAlumno" class="subcard hidden">
          <h4>Agenda del alumno</h4>
          <form id="formReagendar" class="inline-form">
            <label>Fecha y hora:
              <input type="datetime-local" id="reagendarFecha" required />
            </label>
            <button type="submit">Guardar</button>
          </form>
          <ul id="listaAgenda" class="simple-list"></ul>
        </div>
      </div>
    </section>

    <!-- ========== MODO ADMIN ========== -->
    <section id="adminSection" class="panel hidden">
      <div class="card">
        <h2>Ingreso de administrador</h2>
        <form id="formAdminLogin" class="inline-form">
          <label>Código de administrador:
            <input type="password" id="adminPin" inputmode="numeric" maxlength="8" autocomplete="one-time-code" required />
          </label>
          <button type="submit">Entrar</button>
        </form>
        <div id="adminLoginFeedback" class="feedback"></div>
      </div>

      <div id="adminPanel" class="card hidden">
        <div class="admin-grid">
          <div>
            <h3>Alumnos</h3>
            <div class="toolbar">
              <input type="search" id="searchAlumno" placeholder="Buscar por nombre o código…" />
              <button id="btnNuevoAlumno">Agregar alumno</button>
              <button id="btnExportar">Exportar</button>
              <label class="import-label">
                Importar
                <input type="file" id="inputImportar" accept="application/json" />
              </label>
            </div>
            <table class="table" id="tablaAlumnos">
              <thead>
                <tr>
                  <th>Foto</th><th>Nombre</th><th>Código</th><th>Paquete</th><th>Clases</th><th>Vigencia</th><th>Acciones</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div>
            <h3>Configuración</h3>
            <form id="formConfig" class="stack-form">
              <fieldset>
                <legend>Código administrador</legend>
                <label>Actual:
                  <input id="cfgAdminPin" type="password" placeholder="••••" />
                </label>
              </fieldset>
              <fieldset>
                <legend>Precios (MXN)</legend>
                <div class="grid-2">
                  <label>Clase suelta
                    <input id="precio1" type="number" min="0" step="1" />
                  </label>
                  <label>Dos clases
                    <input id="precio2" type="number" min="0" step="1" />
                  </label>
                  <label>Cuatro clases
                    <input id="precio4" type="number" min="0" step="1" />
                  </label>
                  <label>Seis clases
                    <input id="precio6" type="number" min="0" step="1" />
                  </label>
                  <label>Ocho clases
                    <input id="precio8" type="number" min="0" step="1" />
                  </label>
                  <label>Mes completo
                    <input id="precioMes" type="number" min="0" step="1" />
                  </label>
                </div>
              </fieldset>
              <fieldset>
                <legend>Voz</legend>
                <p>La app intenta usar una voz en español del dispositivo. Si no se escucha, activa las voces en Ajustes del sistema.</p>
                <div class="grid-2">
                  <label>Volumen
                    <input type="range" id="voiceVolume" min="0" max="1" step="0.1" />
                  </label>
                  <label>Velocidad
                    <input type="range" id="voiceRate" min="0.6" max="1.4" step="0.1" />
                  </label>
                </div>
                <div class="grid-2">
                  <label>Voz (español)
                    <select id="voiceSelect"></select>
                  </label>
                </div>
                <button type="button" id="probarVoz">Probar voz</button>
              </fieldset>
              <button type="submit">Guardar configuración</button>
            </form>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL ALUMNO -->
  <dialog id="modalAlumno">
    <form method="dialog" id="formAlumno">
      <h3 id="modalAlumnoTitulo">Nuevo alumno</h3>
      <div class="stack-form">
        <label>Nombre completo
          <input id="alNombre" required />
        </label>
        <label>Código (4 dígitos)
          <input id="alCodigo" required inputmode="numeric" minlength="4" maxlength="4" />
        </label>
        <label>Paquete
          <select id="alPaquete">
            <option value="1">Clase suelta (1)</option>
            <option value="2">Dos clases (2)</option>
            <option value="4">Cuatro clases (4)</option>
            <option value="6">Seis clases (6)</option>
            <option value="8">Ocho clases (8)</option>
            <option value="9">Nueve clases (9)</option>
            <option value="10">Diez clases (10)</option>
            <option value="11">Once clases (11)</option>
            <option value="12">Doce clases (12)</option>
            <option value="mes">Mes completo</option>
          </select>
        </label>
        <label>Monto (MXN)
          <input id="alMonto" type="number" min="0" step="1" />
        </label>
        <div class="grid-2">
          <label>Fecha inicio
            <input id="alInicio" type="date" />
          </label>
          <label>Fecha término
            <input id="alFin" type="date" />
          </label>
        </div>
        <details>
          <summary>Datos de contacto</summary>
          <div class="grid-2">
            <label>Teléfono
              <input id="alTel" />
            </label>
            <label>Emergencia
              <input id="alTelEmerg" />
            </label>
            <label>Fecha de nacimiento
              <input id="alFNac" type="date" />
            </label>
            <label>Edad
              <input id="alEdad" type="number" min="0" />
            </label>
            <label>Dirección
              <input id="alDir" />
            </label>
            <label>Forma de pago
              <input id="alFormaPago" placeholder="Efectivo/Transferencia/..." />
            </label>
          </div>
        </details>
        <label>Foto de perfil
          <input id="alFoto" type="file" accept="image/*" />
        </label>
        <details>
          <summary>Historial de pagos</summary>
          <div id="alPagos"></div>
          <button type="button" id="btnAgregarPago">Agregar pago</button>
        </details>
      </div>
      <menu class="dialog-actions">
        <button value="cancel">Cancelar</button>
        <button value="confirm" class="primary">Guardar</button>
      </menu>
    </form>
  </dialog>

  <template id="pagoTemplate">
    <div class="pago-item">
      <div class="grid-3">
        <label>Monto (MXN)
          <input class="pago-monto" type="number" min="0" step="1" required />
        </label>
        <label>Método
          <input class="pago-metodo" placeholder="Efectivo/Transferencia/..." />
        </label>
        <label>Fecha
          <input class="pago-fecha" type="date" />
        </label>
      </div>
      <label>Notas
        <input class="pago-nota" placeholder="Paquete 4 clases / Inscripción / etc." />
      </label>
      <button type="button" class="pago-eliminar danger">Eliminar</button>
    </div>
  </template>

  <script src="app.js"></script>
</body>
</html>
